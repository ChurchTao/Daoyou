# ç¥ç­¾æŠ½å–

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨çš„æ–‡ä»¶**  
- [divine-fortune/route.ts](file://app/api/divine-fortune/route.ts)
- [divineFortune.ts](file://utils/divineFortune.ts)
- [DivineFortune.tsx](file://components/welcome/DivineFortune.tsx)
- [useDivineFortune.ts](file://lib/hooks/useDivineFortune.ts)
- [TypewriterText.tsx](file://components/welcome/TypewriterText.tsx)
- [index.ts](file://lib/redis/index.ts)
- [redisCultivatorRepository.ts](file://lib/repositories/redisCultivatorRepository.ts)
- [fateGenerator.ts](file://utils/fateGenerator.ts)
- [rankings.ts](file://lib/redis/rankings.ts)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [æ ¸å¿ƒåŠŸèƒ½åˆ†æ](#æ ¸å¿ƒåŠŸèƒ½åˆ†æ)
3. [APIè®¤è¯ä¸æµç¨‹æ§åˆ¶](#apiè®¤è¯ä¸æµç¨‹æ§åˆ¶)
4. [å‰ç«¯åŠ¨ç”»ä¸äº¤äº’è®¾è®¡](#å‰ç«¯åŠ¨ç”»ä¸äº¤äº’è®¾è®¡)
5. [ç­¾æ–‡ç±»å‹ä¸å¥–åŠ±ç³»ç»Ÿ](#ç­¾æ–‡ç±»å‹ä¸å¥–åŠ±ç³»ç»Ÿ)
6. [AIåŠ¨æ€æè¿°é›†æˆ](#aiåŠ¨æ€æè¿°é›†æˆ)
7. [å®‰å…¨é™æµä¸é˜²åˆ·ç­–ç•¥](#å®‰å…¨é™æµä¸é˜²åˆ·ç­–ç•¥)
8. [ç”¨æˆ·ä½“éªŒä¼˜åŒ–å»ºè®®](#ç”¨æˆ·ä½“éªŒä¼˜åŒ–å»ºè®®)
9. [ç»“è®º](#ç»“è®º)

## ç®€ä»‹
ç¥ç­¾æŠ½å–åŠŸèƒ½æ˜¯ä¿®ä»™ä¸–ç•Œè§‚ä¸‹çš„ä¸€é¡¹æ ¸å¿ƒäº’åŠ¨æœºåˆ¶ï¼Œé€šè¿‡AIGCæŠ€æœ¯ç”Ÿæˆå¯Œæœ‰å“²ç†çš„"ä»Šæ—¥å¤©æœº"æ ¼è¨€ï¼Œä¸ºç©å®¶æä¾›ä¿®è¡ŒæŒ‡å¼•ã€‚è¯¥åŠŸèƒ½èåˆäº†åç«¯APIæœåŠ¡ã€Redisç¼“å­˜ã€AIå†…å®¹ç”Ÿæˆã€å‰ç«¯åŠ¨ç”»å±•ç¤ºç­‰å¤šä¸ªæŠ€æœ¯æ¨¡å—ï¼Œå½¢æˆäº†å®Œæ•´çš„ç”¨æˆ·ä½“éªŒé—­ç¯ã€‚ç³»ç»Ÿå…·å¤‡é™çº§å®¹é”™æœºåˆ¶ï¼Œåœ¨AIæœåŠ¡ä¸å¯ç”¨æ—¶å¯è‡ªåŠ¨åˆ‡æ¢è‡³é¢„è®¾çš„å¤‡ç”¨æ ¼è¨€æ± ï¼Œç¡®ä¿åŠŸèƒ½çš„é«˜å¯ç”¨æ€§ã€‚

## æ ¸å¿ƒåŠŸèƒ½åˆ†æ

ç¥ç­¾æŠ½å–åŠŸèƒ½çš„æ ¸å¿ƒåœ¨äº`divineFortune.ts`ä¸­çš„æŠ½å–é€»è¾‘ä¸å¥–åŠ±è®¡ç®—ã€‚è¯¥æ¨¡å—å®šä¹‰äº†`DivineFortune`æ¥å£ï¼ŒåŒ…å«`fortune`ï¼ˆå¤©æœºæ ¼è¨€ï¼‰å’Œ`hint`ï¼ˆé“å®¶æç¤ºï¼‰ä¸¤ä¸ªå­—æ®µï¼Œæ„æˆäº†ç­¾æ–‡çš„åŸºæœ¬ç»“æ„ã€‚ç³»ç»Ÿé€šè¿‡`getDivineFortunePrompt`å‡½æ•°ç”ŸæˆAIè°ƒç”¨çš„æç¤ºè¯ï¼Œéµå¾ªä¸¥æ ¼çš„æ ¼å¼è¦æ±‚ï¼šæ ¼è¨€éƒ¨åˆ†10-20å­—ï¼Œå¤é£å“²ç†ï¼›æç¤ºéƒ¨åˆ†8-15å­—ï¼Œé‡‡ç”¨"å®œ/å¿Œ"æ ¼å¼ã€‚å¤‡ç”¨æ ¼è¨€æ± `FALLBACK_FORTUNES`åŒ…å«äº†20æ¡é¢„è®¾çš„é“å®¶ç»å…¸è¯­å½•ï¼Œä½œä¸ºAIç”Ÿæˆå¤±è´¥æ—¶çš„é™çº§æ–¹æ¡ˆã€‚

**æœ¬èŠ‚æ¥æº**  
- [divineFortune.ts](file://utils/divineFortune.ts#L5-L131)

## APIè®¤è¯ä¸æµç¨‹æ§åˆ¶

`divine-fortune/route.ts`APIå®ç°äº†å®Œæ•´çš„è®¤è¯æ ¡éªŒã€å†·å´æ—¶é—´æ§åˆ¶ä¸ç»“æœæŒä¹…åŒ–æµç¨‹ã€‚APIé‡‡ç”¨Next.jsçš„è·¯ç”±å¤„ç†æœºåˆ¶ï¼Œé€šè¿‡`redis`å®ä¾‹å®ç°ç¼“å­˜ç®¡ç†ã€‚ç³»ç»Ÿè®¾ç½®äº†30åˆ†é’Ÿçš„ç¼“å­˜æœ‰æ•ˆæœŸï¼ˆ`CACHE_TTL`ï¼‰ï¼Œæœ‰æ•ˆå‡è½»AIæœåŠ¡çš„è°ƒç”¨å‹åŠ›ã€‚è®¤è¯æµç¨‹ä¾èµ–Supabaseçš„ç”¨æˆ·ç³»ç»Ÿï¼Œç¡®ä¿åªæœ‰æˆæƒç”¨æˆ·æ‰èƒ½è®¿é—®æœåŠ¡ã€‚

æµç¨‹æ§åˆ¶æ–¹é¢ï¼ŒAPIé¦–å…ˆå°è¯•ä»Redisè·å–ç¼“å­˜ç»“æœï¼Œè‹¥å­˜åœ¨åˆ™ç›´æ¥è¿”å›ï¼Œæ ‡è®°`cached: true`ã€‚è‹¥ç¼“å­˜æœªå‘½ä¸­ï¼Œåˆ™è°ƒç”¨AIæœåŠ¡ç”Ÿæˆæ–°çš„å¤©æœºæ ¼è¨€ã€‚ç³»ç»Ÿå®ç°äº†åŒé‡é™çº§ç­–ç•¥ï¼šAIå“åº”è§£æå¤±è´¥æ—¶ä½¿ç”¨å¤‡ç”¨æ ¼è¨€ï¼Œæ•´ä¸ªæœåŠ¡å¼‚å¸¸æ—¶ä¹Ÿè¿”å›å¤‡ç”¨æ–¹æ¡ˆå¹¶æ ‡è®°`fallback: true`ã€‚ç»“æœæŒä¹…åŒ–é€šè¿‡`redis.set`å®ç°ï¼Œç¡®ä¿åç»­è¯·æ±‚èƒ½åœ¨ç¼“å­˜æœ‰æ•ˆæœŸå†…ç›´æ¥è·å–ç»“æœã€‚

```mermaid
sequenceDiagram
participant Client as "å®¢æˆ·ç«¯"
participant API as "divine-fortune/route.ts"
participant Redis as "Redisç¼“å­˜"
participant AI as "AIæœåŠ¡"
Client->>API : GET /api/divine-fortune
API->>Redis : å°è¯•è·å–ç¼“å­˜
alt ç¼“å­˜å­˜åœ¨
Redis-->>API : è¿”å›ç¼“å­˜ç»“æœ
API-->>Client : è¿”å›æˆåŠŸå“åº”(cached : true)
else ç¼“å­˜ä¸å­˜åœ¨
API->>AI : è°ƒç”¨AIç”Ÿæˆå¤©æœº
alt AIè°ƒç”¨æˆåŠŸ
AI-->>API : è¿”å›JSONå“åº”
API->>API : éªŒè¯æ ¼å¼å®Œæ•´æ€§
API->>Redis : å­˜å‚¨ç»“æœ(CACHE_TTL=1800s)
API-->>Client : è¿”å›æˆåŠŸå“åº”
else AIè°ƒç”¨å¤±è´¥
API->>API : ä½¿ç”¨getRandomFallbackFortune()
API-->>Client : è¿”å›å¤‡ç”¨æ–¹æ¡ˆ(fallback : true)
end
end
```

**å›¾ç¤ºæ¥æº**  
- [divine-fortune/route.ts](file://app/api/divine-fortune/route.ts#L18-L80)
- [divineFortune.ts](file://utils/divineFortune.ts#L128-L131)

**æœ¬èŠ‚æ¥æº**  
- [divine-fortune/route.ts](file://app/api/divine-fortune/route.ts#L1-L80)
- [index.ts](file://lib/redis/index.ts#L1-L5)

## å‰ç«¯åŠ¨ç”»ä¸äº¤äº’è®¾è®¡

`DivineFortune.tsx`ç»„ä»¶å®ç°äº†ç²¾ç¾çš„å‰ç«¯åŠ¨ç”»äº¤äº’è®¾è®¡ï¼ŒåŒ…æ‹¬ç­¾ç­’æ‘‡åŠ¨æ•ˆæœã€ç­¾æ–‡æµ®ç°è¿‡æ¸¡ä¸ç»“æœå±•ç¤ºå¸ƒå±€ã€‚ç»„ä»¶é‡‡ç”¨Reactçš„å®¢æˆ·ç«¯æ¸²æŸ“æ¨¡å¼ï¼ˆ'use client'ï¼‰ï¼Œé€šè¿‡`useDivineFortune`Hookè·å–å¤©æœºæ•°æ®ã€‚åœ¨åŠ è½½çŠ¶æ€æ˜¾ç¤º"æ­£åœ¨æ¨æ¼”å¤©æœºâ€¦â€¦"çš„è„‰å†²åŠ¨ç”»ï¼Œä½¿ç”¨`animate-pulse`CSSç±»å®ç°ã€‚

ç­¾æ–‡æµ®ç°é‡‡ç”¨æ‰“å­—æœºæ•ˆæœï¼Œç”±`TypewriterText`ç»„ä»¶å®ç°ã€‚è¯¥ç»„ä»¶é€šè¿‡`useTypewriter`Hookæ§åˆ¶æ–‡æœ¬é€å­—æ˜¾ç¤ºï¼Œæ”¯æŒè‡ªå®šä¹‰é€Ÿåº¦ï¼ˆ`speed`ï¼‰ã€å»¶è¿Ÿï¼ˆ`startDelay`ï¼‰å’Œå¯ç”¨æ§åˆ¶ï¼ˆ`enabled`ï¼‰ã€‚å¤©æœºæ ¼è¨€å’Œæç¤ºä¿¡æ¯çš„æ˜¾ç¤ºæœ‰ç²¾ç¡®çš„æ—¶é—´æ§åˆ¶ï¼šæç¤ºä¿¡æ¯çš„å¼€å§‹å»¶è¿Ÿä¸ºæ ¼è¨€é•¿åº¦Ã—100ms+300msï¼Œç¡®ä¿è§†è§‰ä¸Šçš„è¿è´¯æ€§ã€‚ç»„ä»¶å¸ƒå±€é‡‡ç”¨å±…ä¸­è®¾è®¡ï¼ŒåŒ…å«è£…é¥°æ€§çš„åˆ†éš”çº¿å’Œé“æ•™ç¬¦å·"â˜¯"ï¼Œè¥é€ å‡ºæµ“åšçš„ä¿®ä»™æ°›å›´ã€‚

```mermaid
flowchart TD
Start([ç»„ä»¶åˆå§‹åŒ–]) --> CheckLoading["æ£€æŸ¥isLoadingçŠ¶æ€"]
CheckLoading --> |true| ShowLoading["æ˜¾ç¤ºåŠ è½½åŠ¨ç”»"]
CheckLoading --> |false| CheckFortune["æ£€æŸ¥fortuneæ˜¯å¦å­˜åœ¨"]
CheckFortune --> |false| ReturnNull["è¿”å›null"]
CheckFortune --> |true| RenderLayout["æ¸²æŸ“å®Œæ•´å¸ƒå±€"]
RenderLayout --> RenderTitle["æ˜¾ç¤º'â—† ä»Šæ—¥å¤©æœº â—†'æ ‡é¢˜"]
RenderLayout --> RenderFortune["ä½¿ç”¨TypewriterTextæ˜¾ç¤ºæ ¼è¨€"]
RenderLayout --> RenderHint["ä½¿ç”¨TypewriterTextæ˜¾ç¤ºæç¤º"]
RenderLayout --> RenderDivider["æ˜¾ç¤ºè£…é¥°æ€§åˆ†éš”çº¿"]
ShowLoading --> End([ç»„ä»¶æ¸²æŸ“å®Œæˆ])
ReturnNull --> End
RenderLayout --> End
```

**å›¾ç¤ºæ¥æº**  
- [DivineFortune.tsx](file://components/welcome/DivineFortune.tsx#L18-L76)
- [TypewriterText.tsx](file://components/welcome/TypewriterText.tsx#L16-L50)

**æœ¬èŠ‚æ¥æº**  
- [DivineFortune.tsx](file://components/welcome/DivineFortune.tsx#L1-L76)
- [useDivineFortune.ts](file://lib/hooks/useDivineFortune.ts#L9-L44)

## ç­¾æ–‡ç±»å‹ä¸å¥–åŠ±ç³»ç»Ÿ

ç³»ç»Ÿå®ç°äº†å®Œæ•´çš„ç­¾æ–‡ç±»å‹åˆ†ç±»ä¸å¥–åŠ±ç‰©å“æ‰è½è¡¨é…ç½®ã€‚ç­¾æ–‡ç±»å‹ä¸»è¦åˆ†ä¸º"å‰"ã€"å‡¶"ã€"å¹³"ä¸‰ç±»ï¼Œåœ¨`fateGenerator.ts`ä¸­é€šè¿‡Zodæ¨¡å¼å®šä¹‰äº†`PreHeavenFateSchema`ï¼Œå…¶ä¸­`type`å­—æ®µæ˜ç¡®é™å®šä¸º['å‰', 'å‡¶']ã€‚åœ¨UIå±•ç¤ºä¸­ï¼Œ"å‰"ç­¾ä½¿ç”¨"ğŸ€"ç¬¦å·ï¼Œ"å‡¶"ç­¾ä½¿ç”¨"ğŸ˜ˆ"ç¬¦å·ï¼Œé€šè¿‡`create/page.tsx`ä¸­çš„æ¡ä»¶æ¸²æŸ“å®ç°ã€‚

å¥–åŠ±ç³»ç»Ÿé‡‡ç”¨å“è´¨åˆ†çº§æœºåˆ¶ï¼ŒåŒ…å«å‡¡å“ã€çµå“ã€ç„å“ã€çœŸå“ã€åœ°å“ã€å¤©å“ã€ä»™å“ã€ç¥å“å…«ä¸ªç­‰çº§ã€‚å±æ€§åŠ æˆé€šè¿‡`attribute_mod`å¯¹è±¡é…ç½®ï¼Œæ”¯æŒä½“é­„ã€çµåŠ›ã€æ‚Ÿæ€§ã€é€Ÿåº¦ã€ç¥è¯†äº”ç»´å±æ€§çš„Â±100èŒƒå›´å†…è°ƒæ•´ã€‚æ•°æ®åº“è®¾è®¡ä¸­ï¼Œ`consumables`è¡¨å’Œ`artifacts`è¡¨å‡åŒ…å«`quality`å­—æ®µï¼Œå®ç°äº†å¥–åŠ±ç‰©å“çš„ç»Ÿä¸€å“è´¨ç®¡ç†ã€‚é‚®ä»¶ç³»ç»Ÿä¸­çš„å¥–åŠ±é¢†å–æµç¨‹é€šè¿‡äº‹åŠ¡å¤„ç†ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼Œæ”¯æŒæ¶ˆè€—å“çš„å †å å’Œæ³•å®çš„ç‹¬ç«‹å­˜å‚¨ã€‚

```mermaid
classDiagram
class PreHeavenFate {
+string name
+string type : 'å‰'|'å‡¶'
+string quality
+object attribute_mod
+string description
}
class Consumable {
+string name
+string type
+string quality
+jsonb effect
+integer quantity
+integer score
}
class Artifact {
+string name
+string quality
+string slot
+string element
+jsonb bonus
+jsonb special_effects
+jsonb curses
+integer score
}
class Mail {
+uuid id
+boolean isClaimed
+boolean isRead
+jsonb rewards
}
Mail --> Consumable : "åŒ…å«"
Mail --> Artifact : "åŒ…å«"
PreHeavenFate <|-- Consumable : "ç»§æ‰¿"
PreHeavenFate <|-- Artifact : "ç»§æ‰¿"
```

**å›¾ç¤ºæ¥æº**  
- [fateGenerator.ts](file://utils/fateGenerator.ts#L31-L49)
- [schema.ts](file://lib/drizzle/schema.ts#L158-L173)
- [route.ts](file://app/api/mail/[id]/claim/route.ts#L113-L153)

**æœ¬èŠ‚æ¥æº**  
- [fateGenerator.ts](file://utils/fateGenerator.ts#L31-L69)
- [create/page.tsx](file://app/create/page.tsx#L475-L526)
- [schema.ts](file://lib/drizzle/schema.ts#L158-L173)

## AIåŠ¨æ€æè¿°é›†æˆ

ç³»ç»Ÿé€šè¿‡`aiClient.ts`å®ç°äº†åŸºäºAIçš„åŠ¨æ€æè¿°ç”Ÿæˆé›†æˆã€‚`getDivineFortunePrompt`å‡½æ•°æ„å»ºäº†ç²¾å¿ƒè®¾è®¡çš„ç³»ç»Ÿæç¤ºè¯ï¼ˆsystemPromptï¼‰å’Œç”¨æˆ·æç¤ºè¯ï¼ˆuserPromptï¼‰ï¼Œå¼•å¯¼AIç”Ÿæˆç¬¦åˆä¿®ä»™ä¸–ç•Œè§‚çš„å¤©æœºæ ¼è¨€ã€‚ç³»ç»Ÿæç¤ºè¯æ˜ç¡®è§„å®šäº†è¾“å‡ºæ ¼å¼ä¸ºçº¯JSONï¼ŒåŒ…å«`fortune`å’Œ`hint`å­—æ®µï¼Œå¹¶æä¾›äº†ç¤ºä¾‹ã€‚å†…å®¹è¦æ±‚ç„å¦™ã€ä¼˜é›…ã€æœ‰æ„å¢ƒï¼Œç¦æ­¢ä½¿ç”¨ç°ä»£è¯æ±‡ã€‚

AIè°ƒç”¨é€šè¿‡`object`å‡½æ•°å®ç°ï¼Œä½¿ç”¨Zodæ¨¡å¼éªŒè¯å“åº”æ ¼å¼ï¼Œç¡®ä¿`fortune`å’Œ`hint`å­—æ®µå‡å­˜åœ¨ä¸”éç©ºã€‚è¿™ç§ç»“æ„åŒ–è¾“å‡ºæ–¹å¼é¿å…äº†è‡ªç”±æ–‡æœ¬ç”Ÿæˆçš„ä¸å¯é¢„æµ‹æ€§ï¼Œæé«˜äº†ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯ç»´æŠ¤æ€§ã€‚å½“AIæœåŠ¡ä¸å¯ç”¨æˆ–å“åº”æ ¼å¼é”™è¯¯æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨é™çº§åˆ°æœ¬åœ°çš„`FALLBACK_FORTUNES`æ± ï¼Œä½“ç°äº†è‰¯å¥½çš„å®¹é”™è®¾è®¡ã€‚

**æœ¬èŠ‚æ¥æº**  
- [divineFortune.ts](file://utils/divineFortune.ts#L13-L37)
- [divine-fortune/route.ts](file://app/api/divine-fortune/route.ts#L33-L45)

## å®‰å…¨é™æµä¸é˜²åˆ·ç­–ç•¥

ç³»ç»Ÿå®æ–½äº†å¤šå±‚æ¬¡çš„å®‰å…¨é™æµä¸é˜²åˆ·ç­–ç•¥ï¼Œä¸»è¦åŸºäºRediså®ç°ã€‚`redisCultivatorRepository.ts`ä¸­çš„`checkAndIncrementReroll`å‡½æ•°å®ç°äº†é‡éšæ¬¡æ•°é™åˆ¶ï¼Œé€šè¿‡`REROLL_COUNT_PREFIX`å‰ç¼€çš„è®¡æ•°å™¨è·Ÿè¸ªæ¯ä¸ªä¸´æ—¶è§’è‰²çš„é‡éšæ¬¡æ•°ï¼Œæœ€å¤šå…è®¸3æ¬¡ã€‚è®¡æ•°å™¨ä¸ä¸´æ—¶è§’è‰²æ•°æ®å…±äº«1å°æ—¶çš„TTLï¼Œç¡®ä¿æ•°æ®çš„åŠæ—¶æ¸…ç†ã€‚

æ›´å¤æ‚çš„é™æµæœºåˆ¶ä½“ç°åœ¨æ’è¡Œæ¦œç³»ç»Ÿä¸­ï¼Œ`rankings.ts`å®ç°äº†æ¯æ—¥æŒ‘æˆ˜æ¬¡æ•°é™åˆ¶ï¼ˆ`MAX_DAILY_CHALLENGES`ï¼‰ã€‚é€šè¿‡`DAILY_CHALLENGES_PREFIX`+`cultivatorId`+`today`çš„é”®æ¨¡å¼ï¼Œè®°å½•æ¯ä¸ªç©å®¶æ¯å¤©çš„æŒ‘æˆ˜æ¬¡æ•°ï¼ŒTTLè®¾ç½®ä¸ºåˆ°åˆå¤œçš„å‰©ä½™ç§’æ•°ï¼Œå®ç°è‡ªç„¶çš„æ¯æ—¥é‡ç½®ã€‚ç³»ç»Ÿè¿˜å®ç°äº†åˆ†å¸ƒå¼é”æœºåˆ¶ï¼ˆ`acquireChallengeLock`ï¼‰ï¼Œä½¿ç”¨Redisçš„SET NX EXå‘½ä»¤é˜²æ­¢å¹¶å‘æŒ‘æˆ˜å¯¼è‡´çš„æ•°æ®ç«äº‰ã€‚

```mermaid
flowchart LR
A[ç”¨æˆ·è¯·æ±‚] --> B{æ˜¯å¦é€šè¿‡è®¤è¯?}
B --> |å¦| C[è¿”å›401é”™è¯¯]
B --> |æ˜¯| D{æ˜¯å¦åœ¨å†·å´æœŸ?}
D --> |æ˜¯| E[è¿”å›å‰©ä½™æ—¶é—´]
D --> |å¦| F{æ˜¯å¦è¾¾åˆ°æ¬¡æ•°ä¸Šé™?}
F --> |æ˜¯| G[è¿”å›400é”™è¯¯]
F --> |å¦| H[æ‰§è¡Œæ ¸å¿ƒé€»è¾‘]
H --> I[æ›´æ–°Redisè®¡æ•°å™¨]
I --> J[è®¾ç½®TTL]
J --> K[è¿”å›æˆåŠŸå“åº”]
```

**å›¾ç¤ºæ¥æº**  
- [redisCultivatorRepository.ts](file://lib/repositories/redisCultivatorRepository.ts#L60-L90)
- [rankings.ts](file://lib/redis/rankings.ts#L276-L287)
- [rankings.ts](file://lib/redis/rankings.ts#L346-L360)

**æœ¬èŠ‚æ¥æº**  
- [redisCultivatorRepository.ts](file://lib/repositories/redisCultivatorRepository.ts#L60-L90)
- [rankings.ts](file://lib/redis/rankings.ts#L276-L380)
- [generate-fates/route.ts](file://app/api/generate-fates/route.ts#L36-L45)

## ç”¨æˆ·ä½“éªŒä¼˜åŒ–å»ºè®®

åŸºäºç³»ç»Ÿåˆ†æï¼Œæå‡ºä»¥ä¸‹ç”¨æˆ·ä½“éªŒä¼˜åŒ–å»ºè®®ï¼š

1. **é¢„åŠ è½½åŠ¨ç”»ä¼˜åŒ–**ï¼šå½“å‰åŠ è½½çŠ¶æ€ä»…æ˜¾ç¤ºé™æ€æ–‡æœ¬ï¼Œå»ºè®®å¢åŠ ç­¾ç­’æ‘‡åŠ¨çš„SVGåŠ¨ç”»ï¼Œé…åˆè½»å¾®çš„æ™ƒåŠ¨æ•ˆæœï¼Œå¢å¼ºæ²‰æµ¸æ„Ÿã€‚

2. **ç»“æœåˆ†äº«åŠŸèƒ½**ï¼šå¯å¢åŠ "åˆ†äº«ä»Šæ—¥å¤©æœº"æŒ‰é’®ï¼Œå°†ç­¾æ–‡å†…å®¹ç”Ÿæˆä¸ºç²¾ç¾çš„å›¾ç‰‡å¡ç‰‡ï¼ŒåŒ…å«æ¸¸æˆLOGOå’Œåˆ†äº«äºŒç»´ç ï¼Œä¿ƒè¿›ç¤¾äº¤ä¼ æ’­ã€‚

3. **å†å²è®°å½•åŠŸèƒ½**ï¼šåœ¨Redisä¸­å¢åŠ `divine_fortune_history`é”®ï¼Œå­˜å‚¨ç”¨æˆ·æœ€è¿‘7å¤©çš„å¤©æœºè®°å½•ï¼Œå…è®¸ç”¨æˆ·å›é¡¾å†å²ç­¾æ–‡ã€‚

4. **ä¸ªæ€§åŒ–æ¨è**ï¼šæ ¹æ®ç”¨æˆ·çš„è§’è‰²å¢ƒç•Œã€åŠŸæ³•ç±»å‹ç­‰ç‰¹å¾ï¼Œè°ƒæ•´AIæç¤ºè¯ä¸­çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œç”Ÿæˆæ›´å…·ä¸ªæ€§åŒ–çš„ä¿®è¡Œå»ºè®®ã€‚

5. **ç¦»çº¿æ”¯æŒ**ï¼šåŠ å¼ºæœ¬åœ°å¤‡ç”¨æ ¼è¨€æ± çš„ç®¡ç†ï¼Œå½“ç½‘ç»œä¸å¯ç”¨æ—¶ï¼Œå¯ä»å¤‡ç”¨æ± ä¸­éšæœºé€‰æ‹©å¹¶è®°å½•å·²ä½¿ç”¨è¿‡çš„æ ¼è¨€ï¼Œé¿å…é‡å¤ã€‚

6. **æ— éšœç¢è®¿é—®**ï¼šä¸ºæ‰“å­—æœºæ•ˆæœå¢åŠ å¼€å…³é€‰é¡¹ï¼Œå…è®¸å¯¹åŠ¨ç”»æ•æ„Ÿçš„ç”¨æˆ·å…³é—­é€å­—æ˜¾ç¤ºæ•ˆæœï¼Œæå‡å¯è®¿é—®æ€§ã€‚

## ç»“è®º
ç¥ç­¾æŠ½å–åŠŸèƒ½é€šè¿‡å‰åç«¯ååŒè®¾è®¡ï¼Œå®ç°äº†ä»AIå†…å®¹ç”Ÿæˆåˆ°å‰ç«¯åŠ¨ç”»å±•ç¤ºçš„å®Œæ•´é—­ç¯ã€‚ç³»ç»Ÿæ¶æ„åˆç†ï¼Œå…·å¤‡è‰¯å¥½çš„å®¹é”™æ€§å’Œæ‰©å±•æ€§ã€‚Redisç¼“å­˜å’Œé™æµæœºåˆ¶ç¡®ä¿äº†æœåŠ¡çš„é«˜å¯ç”¨æ€§ï¼Œè€Œå¤šå±‚æ¬¡çš„é™çº§ç­–ç•¥ä¿éšœäº†æç«¯æƒ…å†µä¸‹çš„ç”¨æˆ·ä½“éªŒã€‚æœªæ¥å¯è¿›ä¸€æ­¥ä¼˜åŒ–ä¸ªæ€§åŒ–æ¨èç®—æ³•å’Œç¤¾äº¤åˆ†äº«åŠŸèƒ½ï¼Œæå‡ç”¨æˆ·å‚ä¸åº¦å’Œç•™å­˜ç‡ã€‚