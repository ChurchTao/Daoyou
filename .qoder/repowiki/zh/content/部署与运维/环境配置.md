# 环境配置

<cite>
**本文档引用的文件**   
- [ENV_SETUP.md](file://ENV_SETUP.md)
- [README.md](file://README.md)
- [vercel.json](file://vercel.json)
- [utils/aiClient.ts](file://utils/aiClient.ts)
- [lib/supabase/client.ts](file://lib/supabase/client.ts)
- [lib/supabase/server.ts](file://lib/supabase/server.ts)
- [lib/drizzle/db.ts](file://lib/drizzle/db.ts)
</cite>

## 目录
1. [简介](#简介)
2. [必需环境变量](#必需环境变量)
3. [可选环境变量](#可选环境变量)
4. [API密钥获取方式](#api密钥获取方式)
5. [本地开发环境配置](#本地开发环境配置)
6. [生产环境部署配置](#生产环境部署配置)
7. [常见问题解答](#常见问题解答)
8. [注意事项](#注意事项)

## 简介

《万界道友》是一款基于AIGC驱动的修仙文字游戏，项目依赖环境变量来配置AI服务、数据库连接等关键功能。本文档详细说明了如何设置项目所需的环境变量，包括必需和可选的配置项，以及在本地开发和生产环境中如何正确配置这些变量。

**Section sources**
- [README.md](file://README.md#L1-L282)

## 必需环境变量

### OPENAI_API_KEY

**作用**：这是访问OpenAI API的密钥，是项目运行所必需的。AI客户端使用此密钥来调用大模型服务，用于角色生成、战报生成等AIGC功能。

**配置方法**：
在项目根目录创建 `.env.local` 文件，并添加以下内容：
```bash
OPENAI_API_KEY=sk-your-api-key-here
```

**Section sources**
- [ENV_SETUP.md](file://ENV_SETUP.md#L5-L10)

## 可选环境变量

### OPENAI_BASE_URL

**作用**：用于指定自定义的API地址，以兼容其他OpenAI兼容的API服务，如OpenRouter、DeepSeek、Qwen等。如果不设置，将使用OpenAI的默认地址。

**推荐值**：
```bash
OPENAI_BASE_URL=https://api.openai.com/v1
```

**Section sources**
- [ENV_SETUP.md](file://ENV_SETUP.md#L15-L17)

### OPENAI_MODEL

**作用**：指定使用的模型名称。不同的模型在性能、质量和成本方面有所不同。

**推荐模型**：
- `gpt-4o-mini`：性价比高，速度快（默认）
- `gpt-4o`：质量更高，但更贵
- `gpt-3.5-turbo`：便宜但质量较低

**配置示例**：
```bash
OPENAI_MODEL=gpt-4o-mini
```

**Section sources**
- [ENV_SETUP.md](file://ENV_SETUP.md#L19-L24)

### PROVIDER_CHOOSE

**作用**：指定AI服务提供商。当设置为'ark'时，将使用ARK平台的API配置。

**配置示例**：
```bash
PROVIDER_CHOOSE=ark
```

**Section sources**
- [utils/aiClient.ts](file://utils/aiClient.ts#L10-L11)

### ARK相关变量

当 `PROVIDER_CHOOSE` 设置为 'ark' 时，需要配置以下变量：

- **ARK_BASE_URL**：ARK平台的API基础地址
- **ARK_API_KEY**：ARK平台的API密钥
- **ARK_MODEL_USE**：ARK平台使用的主模型
- **ARK_MODEL_FAST_USE**：ARK平台使用的快速模型

**配置示例**：
```bash
ARK_BASE_URL=https://your-ark-api.com
ARK_API_KEY=your-ark-api-key
ARK_MODEL_USE=qwen-plus
ARK_MODEL_FAST_USE=qwen-turbo
```

**Section sources**
- [utils/aiClient.ts](file://utils/aiClient.ts#L12-L14)

### FAST_MODEL

**作用**：指定快速模式下使用的模型，通常用于需要快速响应的场景。

**配置示例**：
```bash
FAST_MODEL=gpt-3.5-turbo
```

**Section sources**
- [utils/aiClient.ts](file://utils/aiClient.ts#L34-L35)

## API密钥获取方式

### OpenAI官方
访问 [https://platform.openai.com/api-keys](https://platform.openai.com/api-keys) 获取API密钥。

### OpenRouter
访问 [https://openrouter.ai/keys](https://openrouter.ai/keys) 获取API密钥，支持多种模型。

### DeepSeek
访问 [https://platform.deepseek.com/api_keys](https://platform.deepseek.com/api_keys) 获取API密钥。

### 其他兼容服务
确保服务支持OpenAI兼容的API格式即可使用。

**Section sources**
- [ENV_SETUP.md](file://ENV_SETUP.md#L27-L32)

## 本地开发环境配置

### 1. 创建环境文件
在项目根目录创建 `.env.local` 文件。

### 2. 添加必需配置
至少需要添加 `OPENAI_API_KEY`：
```bash
OPENAI_API_KEY=your-api-key-here
```

### 3. 添加可选配置（推荐）
```bash
# OpenAI API Key（必需）
OPENAI_API_KEY=your-api-key-here

# 自定义 API 地址
OPENAI_BASE_URL=https://api.openai.com/v1

# 使用的模型名称
OPENAI_MODEL=gpt-4o-mini
```

### 4. 启动开发服务器
```bash
npm run dev
```

**注意**：修改环境变量后需要重启开发服务器才能生效。

**Section sources**
- [ENV_SETUP.md](file://ENV_SETUP.md#L5-L38)
- [README.md](file://README.md#L190-L225)

## 生产环境部署配置

### Vercel平台配置

1. 在Vercel项目设置中进入"Environment Variables"页面
2. 添加以下环境变量：
   - `OPENAI_API_KEY`：你的OpenAI API密钥
   - `OPENAI_BASE_URL`：API基础地址（可选）
   - `OPENAI_MODEL`：使用的模型名称（可选）

3. 对于Supabase数据库配置，需要添加：
   - `NEXT_PUBLIC_SUPABASE_URL`：Supabase项目URL
   - `NEXT_PUBLIC_SUPABASE_ANON_KEY`：Supabase匿名密钥
   - `DATABASE_URL`：数据库连接URL

4. 对于Redis配置，需要添加：
   - `UPSTASH_REDIS_REST_URL`：Redis REST URL
   - `UPSTASH_REDIS_REST_TOKEN`：Redis REST令牌

### 配置文件示例
```json
{
  "env": {
    "OPENAI_API_KEY": "your-api-key",
    "OPENAI_BASE_URL": "https://api.openai.com/v1",
    "OPENAI_MODEL": "gpt-4o-mini"
  }
}
```

**Section sources**
- [vercel.json](file://vercel.json#L1-L14)
- [lib/supabase/client.ts](file://lib/supabase/client.ts#L5-L6)
- [lib/supabase/server.ts](file://lib/supabase/server.ts#L4-L5)
- [lib/drizzle/db.ts](file://lib/drizzle/db.ts#L5)

## 常见问题解答

### 如何获取API密钥？
参考本文档的"API密钥获取方式"章节，访问相应平台的开发者控制台获取API密钥。

### 环境变量配置后不生效怎么办？
1. 确保文件名为 `.env.local`（开发环境）或在部署平台正确配置
2. 重启开发服务器
3. 检查变量名是否拼写正确
4. 确认没有在代码中硬编码其他值

### 可以使用哪些替代AI服务？
项目支持任何兼容OpenAI API格式的服务，包括：
- OpenRouter
- DeepSeek
- Qwen（通义千问）
- 其他支持OpenAI兼容API的平台

### 生产环境和开发环境的配置有何不同？
- 开发环境：使用 `.env.local` 文件
- 生产环境：在部署平台（如Vercel）的环境变量设置中配置
- 敏感信息（如API密钥）不应提交到版本控制系统

**Section sources**
- [ENV_SETUP.md](file://ENV_SETUP.md#L27-L38)
- [README.md](file://README.md#L205-L217)

## 注意事项

1. `.env.local` 文件已被添加到 `.gitignore`，不会被提交到Git仓库，确保了API密钥的安全性。

2. 修改环境变量后需要重启开发服务器才能生效。

3. 生产环境需要在部署平台（如Vercel）配置环境变量，而不是使用 `.env.local` 文件。

4. 敏感信息如API密钥应妥善保管，避免泄露。

5. 使用第三方API服务时，请注意查看其使用条款和费用说明。

6. 建议为不同的环境（开发、测试、生产）使用不同的API密钥，以便于管理和监控。

**Section sources**
- [ENV_SETUP.md](file://ENV_SETUP.md#L34-L38)