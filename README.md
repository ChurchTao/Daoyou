# 《万界道友》（Wan Jie Dao You）

一款以 **AIGC 驱动、高自由度文字体验、修仙世界观** 为核心的开源游戏项目。  
你将在万界中以一名普通修士的身份出场，通过 **功法、灵根、神通、法宝、奇遇** 等要素，一步步推演属于自己的修行之路。

本项目目前仍在快速演化中，已实现 **角色生成、战斗引擎、基础装备与技能体系、部分水墨文字 UI**，并预留了大量可供二次开发和内容扩展的空间。

---

## 目录

- [项目愿景](#项目愿景)
- [核心特色](#核心特色)
- [游戏世界与机制概览](#游戏世界与机制概览)
  - [属性与灵根](#属性与灵根)
  - [境界体系](#境界体系)
  - [技能与功法](#技能与功法)
  - [状态与战斗](#状态与战斗)
  - [物品与法宝](#物品与法宝)
- [UI 与交互风格](#ui-与交互风格)
- [项目结构](#项目结构)
- [本地开发与运行](#本地开发与运行)
- [如何参与贡献](#如何参与贡献)
- [路线图与 TODO](#路线图与-todo)
- [许可证](#许可证)

---

## 项目愿景

**《万界道友》希望成为一套“修仙宇宙的开源骨架”**：

- 既是一个可以直接游玩的 **文字修仙游戏**；
- 也是一套 **高度结构化、AIGC 友好** 的底层架构，方便创作者在此基础上快速搭建：
  - 自己的门派流派 / 世界观；
  - 各种玩法（宗门战、秘境探索、多人对战等）；
  - 不同风格的前端 UI（网页 / 客户端 / 终端）。

我们希望：

- 玩法层面鼓励 **高自由度输入 + AIGC 反馈**；
- 系统层面保持 **稳定、正交、可组合**；
- 表现层面坚持 **文字即界面，水墨意境，移动端优先**。

---

## 核心特色

- **AIGC 驱动的修仙体验**
  - 角色背景、战报叙事、奇遇文本等均可由大模型生成；
  - 同时通过严格的数据模型约束，确保数值与战斗逻辑稳定可控。

- **完备的修仙数据与战斗框架**
  - 预定义的 **元素体系 / 属性 / 灵根 / 境界 / 状态系统 / 物品体系**；
  - 战斗引擎以 TypeScript 实现，清晰可读，易于扩展。

- **纯文字 + 水墨风 UI**
  - 参考 `ui.md`，采用 **方括号按钮、分隔线符号、古风提示语** 等；
  - **移动端优先** 的单列排版，PC 端通过响应式适配。

- **对开发者与 Mod 友好**
  - 所有核心机制均有清晰的 JSON 结构定义（见 `basic.md`）；
  - 简单追加枚举即可扩展新元素、新状态、新法宝效果；
  - 适合做 **二创同人 / AI 驱动的剧情策划 / 教学示例**。

---

## 游戏世界与机制概览

> 本节为高层说明，详细公式与完整 JSON Schema 见 `basic.md`。

### 属性与灵根

- **基础属性（Attributes）**
  - `vitality`（体魄）：血量上限与伤害减免；
  - `spirit`（灵力）：法术伤害与资源上限；
  - `wisdom`（悟性）：暴击率、突破成功率；
  - `speed`（速度）：出手顺序、闪避率；
  - `willpower`（神识）：控制抗性、状态抵抗。

- **灵根（Spiritual Roots）**
  - 元素枚举：`金、木、水、火、土、风、雷、冰、无`；
  - 每个角色可拥有 1–3 个灵根，每个灵根有 `element + strength`；
  - 直接影响对应元素技能的伤害与发挥上限。

### 境界体系

- 境界从 `炼气 → 筑基 → 金丹 → 元婴 → 化神 → 炼虚 → 合体 → 大乘 → 渡劫` 逐层提升；
- 每一境界限定：
  - 属性上限；
  - 寿命参数；
  - 可习得技能 / 功法等级；
- 数据中记录 `realm + realm_stage（初/中/后/圆满） + age + lifespan`。

### 技能与功法

- **神通（Active Skills）**
  - 类型：`attack / heal / control / debuff / buff`；
  - 拥有 `element, power, cost, cooldown` 等字段；
  - 决定战斗中可执行的动作与行为模式。

- **功法（Cultivations，Passive）**
  - 长期被动加成，如属性提升、抗性增强；
  - 包含前置境界要求 `required_realm`。

### 状态与战斗

- 状态分为：
  - 增益：`armor_up, speed_up, crit_rate_up ...`；
  - 控制：`stun, silence, root ...`；
  - 异常：`burn, bleed, poison ...`。
- 战斗流程包含：
  1. 初始化（合并基础属性 + 功法 + 气运 + 装备）；
  2. 回合循环：持续状态结算 → 速度判定 → 技能释放 → 装备触发；
  3. 结束判定：胜负、生死、寿元终结等。

项目中提供了完整的 TypeScript 战斗引擎实现，文件位于 `engine/battleEngine.ts`，同时在 `basic.md` 中有带注释的伪代码示例，方便阅读与迁移。

### 物品与法宝

- **消耗品**：丹药、卷轴等，一次性使用，恢复 / buff / 突破；
- **法宝（Artifacts）**：
  - 装备槽：`weapon / armor / accessory`；
  - 元素属性 + 数值加成 + 特殊效果（如 `on_hit_add_effect` 等）；
  - 可额外带有“诅咒”类负面后果。

所有物品结构均严格遵循 JSON Schema，确保可由大模型直接生成合法数据。

---

## UI 与交互风格

本项目的界面设计遵循 `ui.md` 中的规范，要点包括：

- **文字即界面**
  - 不依赖重资源图标；使用文本排版、Unicode 符号与留白构建体验；
  - 示例：`【道我真形】`、`【储物袋】`、`【天骄榜】` 等模块标题。

- **水墨修仙语境**
  - 系统提示、错误提示均采用修仙风文案，如：
    - 加载中：`正在推演天机……`
    - 错误：`此法有违天道，恐遭反噬。`
    - 空状态：`储物袋空空如也，道友该去寻宝了。`

- **移动端优先排版**
  - 单列布局、底部拇指热区按钮；
  - PC 端最大宽度约 600px，内容居中展示。

- **Ink 组件体系（前端抽象层）**
  - 项目中提供了一套 `Ink` 风格组件（如 `InkButton`, `InkBadge`, `InkTag`, `InkPageShell` 等），用于：
    - 快速搭建修仙风页面；
    - 统一按钮、标签、状态条、对话框等常见交互元素；
  - 组件实现主要位于 `components/` 目录，可在 `ui.md` 中查看设计说明与用法示例。

---

## 项目结构

仅列出与玩法和架构最相关的一些目录（简化版）：

- `app/`
  - Next.js 应用的路由与页面实现，例如：
    - `app/page.tsx`：首页 / 主界面；
    - `app/create/page.tsx`：角色创建；
    - `app/battle/*`：战斗入口、战报回放、历史战斗；
    - `app/cultivator/page.tsx`：角色详情与道身信息。
- `components/`
  - `InkLayout`, `InkUIProvider`, `InkComponents.tsx`：水墨风 UI 框架；
  - `BattleReplayViewer.tsx`, `RecentBattles.tsx`：战斗记录相关组件；
  - `func/`：与功法 / 灵根 / 神通 UI 展示相关的组件。
- `engine/`
  - `battleEngine.ts`：核心战斗引擎与回合逻辑。
- `utils/`
  - `characterEngine.ts`：角色属性与构建逻辑；
  - `cultivatorUtils.ts`：修士数据相关工具；
  - `fateGenerator.ts`：先天气运与命格生成；
  - `prompts.ts`：用于 AIGC 的 Prompt 模板与约束。
- `lib/`
  - `drizzle/`：基于 Drizzle 的数据库 schema 与连接；
  - `auth/` & `supabase/`：匿名用户管理、Supabase 接入。
- `drizzle/`
  - 数据迁移与表结构快照。
- `types/`
  - `cultivator.ts`, `constants.ts`, `dictionaries.ts`：类型声明与枚举。
- 文档
  - `basic.md`：核心机制与战斗引擎设计文档（强烈推荐先读）；
  - `ui.md`：UI/UX 设计规范与组件体系说明；
  - `ENV_SETUP.md`：环境配置说明（如有更新请以文件为准）。

---

## 本地开发与运行

### 1. 环境准备

- Node.js 版本：推荐 **Node 18+**；
- 包管理器：项目使用 `npm`（也可以用 `pnpm`/`yarn`，自行调整命令）。

### 2. 安装依赖

```bash
git clone https://github.com/your-name/wanjiedaoyou.git
cd wanjiedaoyou
npm install
```

### 3. 环境变量与数据库

项目使用 **Supabase + Drizzle**：

- 参考仓库中的 `ENV_SETUP.md` 配置环境变量（Supabase URL / Key 等）；
- 按需运行 Drizzle 迁移以初始化数据库：

```bash
npx drizzle-kit migrate
```

（具体命令以项目实际脚本为准，可查阅 `package.json` 与 `drizzle.config.ts`。）

### 4. 启动开发服务器

```bash
npm run dev
```

默认情况下，应用将运行在 `http://localhost:3000`。  
进入首页后，你可以创建一个新的修士，尝试战斗、查看战报、体验基础的文字修仙流程。

---

## 如何参与贡献

欢迎任何形式的贡献，包括但不限于：

- **玩法设计**：新的境界层次、状态效果、法宝特性；
- **AIGC Prompt 调优**：改进 `utils/prompts.ts`，让生成的角色 / 战报更有味道；
- **UI/UX 优化**：根据 `ui.md` 提升沉浸感与可用性；
- **文档与翻译**：完善英文 README 或为世界观撰写更多设定；
- **Bug 修复与重构**：改进战斗引擎、数值计算、数据库结构等。

推荐流程：

1. Fork 仓库；
2. 创建分支：`feature/xxx` 或 `fix/xxx`；
3. 提交变更并附上简要说明与截图（如涉及 UI）；
4. 发起 Pull Request，说明改动动机与大致设计思路。

如需讨论大型改动（例如：新系统、新模块），建议先通过 Issue 或讨论区沟通设计草案。

---

## 路线图与 TODO

以下是若干中近期的方向构想（非承诺）：

- **短期**
  - 完善角色创建流程与引导文案；
  - 丰富更多基础法宝与神通示例；
  - 优化移动端体验与加载态文案。

- **中期**
  - 加入更多玩法：闭关顿悟、秘境探索、宗门任务等；
  - 打通更多 AIGC 链路（如奇遇、宗门评价等叙事节点）；
  - 提供一套可直接复用的“模组模板”（例如：门派扩展包）。

- **长期**
  - 探索多人交互玩法（如异步 PVP、共修副本等）；
  - 提供更通用的“修仙宇宙 SDK”，便于其它项目直接接入本引擎。

欢迎在 Issue 中补充你的想法，道友的每一句建议，都是此方世界的另一条时间线。

---

## 许可证

本项目计划以 **MIT License** 开源（若仓库中存在 `LICENSE` 文件，请以该文件为准）。  
你可以在遵守许可证的前提下自由使用、修改和分发本项目，包括但不限于：

- 自行部署一份《万界道友》供玩家游玩；
- 在此基础上创作衍生作品（商业 / 非商业）；
- 将其中的战斗引擎、数据模型或 UI 体系抽取到其他项目中使用。

愿你在万界中得一二知己，共证长生。
