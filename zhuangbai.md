接下去要开发成长演化系统，触及了文字修仙游戏从“基础对战”迈向“深度养成”的关键一步。下面我将为你**系统化梳理成长演化体系的结构**，明确各子系统之间的关系，并给出一条**低代码、高 AIGC 占比、可逐步迭代的开发路径**。

---

## 一、核心目标

让玩家通过自然语言提示词实现三类成长行为：

1. **炼器** → 获得法宝/装备 → 存入储物袋 → 可装备（替换）
2. **顿悟** → 获得新技能/神通 → 因“神识有限”，需替换旧技能
3. **奇遇** → 获得一次性物品（丹药、符箓）或触发状态（临时 buff）

所有行为都围绕 **角色数据模型的扩展与约束** 展开。

---

## 二、角色数据模型扩展（必须新增的字段）

在原有角色 JSON 基础上，增加以下结构：

```json
{
  "inventory": {
    "equipments": [  // 所有已获得的法宝（储物袋）
      {
        "id": "eq_001",
        "name": "青木灵杖",
        "type": "weapon",  // weapon / armor / accessory
        "element": "木",
        "base_bonus": { "spirit": 10 },
        "special_effect": "木系技能威力 +30%"
      }
    ],
    "consumables": [   // 丹药、符箓等
      { "name": "回春丹", "effect": "恢复 50 HP" }
    ]
  },

  "equipped": [], // 携带中的法宝
  "max_equipments": 3, // 最大同时装备数（防止装备过载）

  "skills": [
    { "id": "sk_001", "name": "藤蔓缚", ... }
  ],

  "max_skills": 4,         // 最大同时持有技能数（防止走火入魔）

  "attributes": { ... },   // 原有属性
  "pre_heaven_fates": [ ... ]
}
```

> 💡 关键设计原则：
>
> - **储物袋 = inventory.equipments**（只读列表，不直接生效）
> - **实际加成 = equipped 中装备的属性**
> - **技能数量上限 = max_skills**（通常 2~4 个）

---

## 三、三大成长行为的系统逻辑

### 1. 🔥 炼器系统（Create Equipment）

#### 流程：

```
用户输入：“炼制一把融合凤凰真火与玄冰之力的长枪”
     ↓
调用 LLM → 生成新装备 JSON
     ↓
后端校验（名称、类型、数值范围）
     ↓
加入 inventory.equipments
     ↓
前端提示：“新法宝【焚霜枪】已收入储物袋！”
```

#### LLM Prompt 要点：

- 要求输出标准装备结构（含 type、bonus、special_effect）
- 示例效果：`"spirit +15, 火系技能附带【灼烧】"`

---

### 2. 🌌 顿悟系统（Create Skill）

#### 流程：

```
用户输入：“在雷劫中顿悟一门攻防一体的雷遁之术”
     ↓
调用 LLM → 生成新技能 JSON
     ↓
若 skills.length >= max_skills：
    → 提示用户选择一个旧技能替换
    → 用户选择 sk_002
    → 用新技能替换 sk_002
否则：
    → 直接加入 skills
```

#### 关键约束：

- **不能无限堆技能**（模拟“神识负荷”）
- 替换是**主动决策**，增加策略性

#### LLM Prompt 要点：

- 要求包含：name, type, power (50-100), element, effects
- 鼓励创意命名：“九天应雷诀”“无相雷遁”

---

### 3. 🌀 奇遇系统（Gain Items / Buffs）

#### 流程：

```
用户输入：“在古墓中发现一枚玉简，记载失传的疗伤秘术”
     ↓
调用 LLM → 判断产出类型：
        - 若为技能 → 走顿悟流程
        - 若为装备 → 走炼器流程
        - 若为消耗品 → 加入 inventory.consumables
        - 若为临时状态 → 记录到 active_buffs（战斗时生效）
```

> 💡 初期可简化：奇遇只产出 **装备** 或 **消耗品**，避免状态管理复杂化。

---

## 四、系统间协同关系图

```
                ┌──────────────┐
                │  用户输入提示词  │
                └──────┬───────┘
                       ↓
           ┌──────────┴──────────┐
           │   AIGC 解析意图     │←─ LLM 判断是炼器/顿悟/奇遇
           └──────────┬──────────┘
                      ↓
    ┌─────────────────┼─────────────────┐
    ↓                 ↓                 ↓
[炼器系统]        [顿悟系统]        [奇遇系统]
    ↓                 ↓                 ↓
更新 inventory   更新 skills     更新 inventory 或 buffs
    │                 │
    ↓                 ↓
[装备管理界面] ←─ 用户可手动切换 equipped
    │
    ↓
[战斗引擎] ←─ 读取 equipped + skills 计算战力
```

> ✅ 所有系统最终服务于 **战斗引擎**，而战斗结果又可能触发新的**奇遇**（如“击败强敌后获得其本命法宝”），形成闭环。

---

## 五、开发路径建议（分阶段 MVP）

### 🚧 阶段 1：支持“炼器 + 储物袋 + 装备切换”（1~2 天）

1. **扩展角色数据模型**：加入 `inventory.equipments` 和 `equipped`
2. **实现炼器 Prompt**：LLM 生成装备 → 存入 inventory
3. **前端加“装备管理”页面**：列出储物袋 + 当前装备 + “装备/卸下”按钮
4. **战斗引擎读取 equipped**：计算属性时叠加装备加成

> ✅ 此阶段即可体验“打造神兵 → 装备 → 战斗变强”的完整循环。

---

### 🌱 阶段 2：加入“顿悟 + 技能替换”（1 天）

1. **设定 max_skills = 3**
2. **顿悟 Prompt**：生成新技能
3. **若技能满员，弹出替换选择框**（前端展示技能列表）
4. **更新 skills 数组**

> ⚠️ 注意：战斗引擎需动态读取当前 skills，而非缓存。

---

### 🌀 阶段 3：奇遇系统（0.5 天）

1. **奇遇 Prompt**：允许生成 consumables（如“回春丹”）
2. **战斗前可使用消耗品**（简单实现：点击“使用回春丹” → hp += 50）
3. **未来扩展**：奇遇可触发临时 buff（如“获得雷劫庇护：下一战雷系伤害 +50%”）

---

## 六、AIGC 占比与编码边界

| 功能     | AIGC 占比 | 需要编码的部分               |
| -------- | --------- | ---------------------------- |
| 装备生成 | 95%       | 校验数值、存入 inventory     |
| 技能生成 | 95%       | 技能数量检查、替换逻辑       |
| 奇遇解析 | 80%       | 判断产出类型、分发到对应库存 |
| 装备切换 | 0%        | 纯前端交互 + 数据更新        |
| 战斗读取 | 0%        | 读取 equipped 和 skills      |

> 💡 **总原则**：AIGC 负责“创造内容”，代码负责“管理状态”。

---

## 七、示例：完整用户流程

1. 用户输入：“炼一把火属性飞剑，剑身铭刻‘焚天’二字” → 获得装备 `焚天剑`（火，spirit+12，火系伤害+25%）
2. 在装备界面点击“装备” → `equipped = ["eq_002"]`
3. 输入：“闭关参悟《南明离火诀》” → 获得新技能 `南明离火`（attack, power=85, fire）→ 因已有3个技能，选择替换掉旧技能“火球术”
4. 挑战排行榜 → 战斗引擎自动使用新装备+新技能 → 获胜！

---
