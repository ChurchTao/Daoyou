为了实现《凡人修仙传》那种“仙途险恶、谨小慎微、步步惊心”的副本体验，我们需要将 LLM 塑造成一个**冷酷但公正的“天道叙述者”**。

以下是为您设计的系统提示词（System Prompt）和数据结构方案。

---

## 1. 系统提示词（System Prompt）

建议将此提示词设定为 LLM 的角色基调。它规定了叙事风格、逻辑判断标准和输出格式。

```markdown
# Role: 《凡人修仙传》副本演化天道

你是一个基于《凡人修仙传》小说逻辑的文字游戏副本驱动引擎。你负责根据玩家信息生成充满危机、转折与机缘的副本叙事。

## 核心叙事准则

1. **凡人流风格**：强调修仙界的残酷与资源匮乏。主角并非无敌，每一次选择都可能导致重伤甚至陨落。描述需简练、有古意，注重环境描写（如：禁制波动、药香、阴冷气息）。
2. **逻辑判定**：
   - 依据玩家的【境界】判断其实力上限。
   - 依据玩家的【性格/命格】触发特殊文本（如：性格谨慎者更易发现陷阱）。
   - 依据玩家的【道具/法宝】提供特定选项（如：拥有噬金虫则可吞噬阵法）。
3. **互动结构**：副本固定为3-5轮。
   - 前期：潜入、破禁、遭遇小危机。
   - 中期：博弈、转折、选择（如：是否与同行修士反目）。
   - 后期：最终考验、取宝、逃亡。
4. **资源损耗**：选项应包含实质性代价，如“损耗百年寿元”、“法宝受损”、“消耗大量灵石”。

## 约束条件

- 严禁输出超出《凡人》世界观的内容。
- 必须以 JSON 格式输出，以便系统解析。
- 结局必须根据玩家在过程中的选择（稳健度、危险度）给出评价。

## 交互逻辑

- 每一轮，你需要提供环境描述和3个逻辑迥异的选项。
- 选项1：稳健/低收益（符合韩立风格）。
- 选项2：激进/高风险。
- 选项3：特定法宝/属性触发的奇招（必须关联玩家道具栏）。
```

---

## 2. 数据结构设计

为了让你的游戏后台能够精准处理逻辑，建议采用结构化的 JSON 交换格式。

### A. 输入结构（游戏后端 -> LLM）

每一轮交互时，你需要将当前状态传给大模型。

```json
{
  "player_info": {
    "name": "厉飞雨",
    "realm": "结丹中期",
    "personality": "冷静谨慎",
    "fate": "五行均衡",
    "attributes": { "spiritual_power": 85, "luck": 12 }
  },
  "inventory": [
    { "name": "青竹蜂云剑", "type": "法宝", "desc": "辟邪神雷" },
    { "name": "中级灵石", "count": 50 },
    { "name": "阵法罗盘", "type": "消耗品" }
  ],
  "dungeon_context": {
    "location": "古修士水府",
    "current_round": 1,
    "max_rounds": 3,
    "history": [] // 记录之前的选择
  }
}
```

### B. 输出结构（LLM -> 游戏后端）

大模型返回的内容，直接用于前端展示和逻辑判定。

```json
{
  "scene_description": "你踏入水府大厅，四周石壁上的夜明珠忽明忽暗。正前方有一尊被禁制笼罩的药鼎，散发着淡淡的清香，但药鼎周围散落着几具枯骨，显然此处禁制非比寻常。",
  "interaction": {
    "options": [
      {
        "id": 1,
        "text": "稳健应对：祭出阵法罗盘，缓慢解析禁制。内容：安全但耗时。",
        "risk_level": "low",
        "requirement": "阵法罗盘"
      },
      {
        "id": 2,
        "text": "强力破禁：以青竹蜂云剑硬劈，速战速决。",
        "risk_level": "high",
        "requirement": "攻击类法宝"
      },
      {
        "id": 3,
        "text": "剑走偏锋：利用五行属性感应禁制薄弱点，试图潜入。",
        "risk_level": "medium",
        "requirement": "五行均衡命格"
      }
    ]
  },
  "status_update": {
    "is_final_round": false,
    "internal_danger_score": 20 // LLM内部维护的危险评估，用于后续生成
  }
}
```

### C. 结算结构（最后一轮 LLM 输出）

当 `current_round == max_rounds` 时，LLM 输出结算建议。

```json
{
  "ending_narrative": "你最终惊险地从崩塌的水府中遁出。虽然损毁了一件防御法宝，但成功带出了那枚‘定灵丹’。",
  "settlement": {
    "reward_tier": "A", // S/A/B/C/D
    "potential_items": ["定灵丹", "古修士残页"],
    "resource_loss": { "durability_loss": 20, "spirit_stones": -10 }
  }
}
```

---

## 3. 专业实现建议（避坑指南）

1. **数值归系统，剧情归模型**：不要让 LLM 直接决定“扣除 52 点血”。应该让 LLM 输出 `damage_intensity: "medium"`，然后你的**后端代码**根据玩家的防御属性，计算出具体的伤害数值。这样可以保证游戏的数值平衡不被 LLM 的随机性破坏。
2. **法宝的“锚点”作用**：在 Prompt 中明确要求 LLM：_“如果玩家背包中有【具体名称】的道具，请务必在选项 3 中设计与之相关的特殊互动。”_ 这是让玩家觉得“这就是我的专属冒险”的关键。
3. **转折点的处理**：在第 2 或第 3 轮，可以强制要求 LLM 加入一个“意外因素”，例如：_“突然有另一名结丹期修士闯入”_ 或 _“原本稳定的阵法开始暴走”_。这符合《凡人》中“杀人夺宝”或“环境剧变”的常态。
4. **长短期记忆处理**：由于副本只有 3-5 轮，你可以将之前的对话历史全部带入 Prompt。如果副本更长，建议只带入 **“关键决策摘要”**（Summary）以节省 Token。

**您想尝试针对某个具体的副本场景（比如“乱星海虚天殿外围”）生成一段测试对话吗？我可以演示这个提示词的效果。**
